"use strict";(()=>{var Ve=()=>!0,T=class{constructor(n,t,e){this.root=n,this.currentNode=n,this.nodeType=t,this.filter=e||Ve}isAcceptableNode(n){let t=n.nodeType;return!!((t===Node.ELEMENT_NODE?1:t===Node.TEXT_NODE?4:0)&this.nodeType)&&this.filter(n)}nextNode(){let n=this.root,t=this.currentNode,e;for(;;){for(e=t.firstChild;!e&&t&&t!==n;)e=t.nextSibling,e||(t=t.parentNode);if(!e)return null;if(this.isAcceptableNode(e))return this.currentNode=e,e;t=e}}previousNode(){let n=this.root,t=this.currentNode,e;for(;;){if(t===n)return null;if(e=t.previousSibling,e)for(;t=e.lastChild;)e=t;else e=t.parentNode;if(!e)return null;if(this.isAcceptableNode(e))return this.currentNode=e,e;t=e}}previousPONode(){let n=this.root,t=this.currentNode,e;for(;;){for(e=t.lastChild;!e&&t&&t!==n;)e=t.previousSibling,e||(t=t.parentNode);if(!e)return null;if(this.isAcceptableNode(e))return this.currentNode=e,e;t=e}}};var y="\u200B",M=/[^ \t\r\n]/,E={};function U(){return E.init||(E.ua=navigator.userAgent,E.isMac=/Mac OS X/.test(E.ua),E.isIOS=/iP(?:ad|hone|od)/.test(E.ua)||E.isMac&&!!navigator.maxTouchPoints,E.isLegacyEdge=/Edge\//.test(E.ua),E.isWebKit=!E.isLegacyEdge&&/WebKit\//.test(E.ua),E.isWin=/Windows NT/.test(E.ua),E.isAndroid=/Android/.test(E.ua),E.isGecko=/Gecko\//.test(E.ua),E.ctrlKey=E.isMac||E.isIOS?"Meta-":"Ctrl-",E.cantFocusEmptyTextNodes=E.isWebKit,E.supportsInputEvents="onbeforeinput"in document&&"inputType"in new InputEvent("input"),E.init=!0),E}var et=/^(?:#text|A(?:BBR|CRONYM)?|B(?:R|D[IO])?|C(?:ITE|ODE)|D(?:ATA|EL|FN)|EM|FONT|HR|I(?:FRAME|MG|NPUT|NS)?|KBD|Q|R(?:P|T|UBY)|S(?:AMP|MALL|PAN|TR(?:IKE|ONG)|U[BP])?|TIME|U|VAR|WBR)$/,tt=new Set(["BR","HR","IFRAME","IMG","INPUT"]),nt=0,Se=1,Ae=2,De=3,ae=new WeakMap,we=()=>{ae=new WeakMap},F=i=>tt.has(i.nodeName),Te=i=>{switch(i.nodeType){case 3:return Se;case 1:case 11:if(ae.has(i))return ae.get(i);break;default:return nt}let n;return Array.from(i.childNodes).every(g)?et.test(i.nodeName)?n=Se:n=Ae:n=De,ae.set(i,n),n},g=i=>Te(i)===Se,q=i=>Te(i)===Ae,$=i=>Te(i)===De;var N=(i,n,t)=>{let e=document.createElement(i);if(n instanceof Array&&(t=n,n=null),n)for(let o in n){let s=n[o];s!==void 0&&e.setAttribute(o,s)}return t&&t.forEach(o=>e.appendChild(o)),e},Ce=(i,n)=>F(i)||i.nodeType!==n.nodeType||i.nodeName!==n.nodeName?!1:i instanceof HTMLElement&&n instanceof HTMLElement?i.nodeName!=="A"&&i.className===n.className&&i.style.cssText===n.style.cssText:!0,ce=(i,n,t)=>{if(i.nodeName!==n)return!1;for(let e in t)if(!("getAttribute"in i)||i.getAttribute(e)!==t[e])return!1;return!0},S=(i,n,t,e)=>{for(;i&&i!==n;){if(ce(i,t,e))return i;i=i.parentNode}return null},de=(i,n)=>{let t=i.childNodes;for(;n&&i instanceof Element;)i=t[n-1],t=i.childNodes,n=t.length;return i},_e=(i,n)=>{let t=i;if(t instanceof Element){let e=t.childNodes;if(n<e.length)t=e[n];else{for(;t&&!t.nextSibling;)t=t.parentNode;t&&(t=t.nextSibling)}}return t},B=i=>i instanceof Element||i instanceof DocumentFragment?i.childNodes.length:i instanceof CharacterData?i.length:0,C=i=>{let n=document.createDocumentFragment(),t=i.firstChild;for(;t;)n.appendChild(t),t=i.firstChild;return n},_=i=>{let n=i.parentNode;return n&&n.removeChild(i),i},k=(i,n)=>{let t=i.parentNode;t&&t.replaceChild(n,i)};var ot=i=>i instanceof Element?i.nodeName==="BR":M.test(i.data),te=(i,n)=>{let t=i.parentNode;for(;g(t);)t=t.parentNode;let e=new T(t,5,ot);return e.currentNode=i,!!e.nextNode()||n&&!e.previousNode()},ie=(i,n)=>{let t=new T(i,4),e,o;for(;e=t.nextNode();)for(;(o=e.data.indexOf(y))>-1&&(!n||e.parentNode!==n);)if(e.length===1){let s=e,r=s.parentNode;for(;r&&(r.removeChild(s),t.currentNode=r,!(!g(r)||B(r)));)s=r,r=s.parentNode;break}else e.deleteData(o,1)};var it=0,st=1,rt=2,lt=3,G=(i,n,t)=>{let e=document.createRange();if(e.selectNode(n),t){let o=i.compareBoundaryPoints(lt,e)>-1,s=i.compareBoundaryPoints(st,e)<1;return!o&&!s}else{let o=i.compareBoundaryPoints(it,e)<1,s=i.compareBoundaryPoints(rt,e)>-1;return o&&s}},x=i=>{let{startContainer:n,startOffset:t,endContainer:e,endOffset:o}=i;for(;!(n instanceof Text);){let s=n.childNodes[t];if(!s||F(s)){if(t&&(s=n.childNodes[t-1],s instanceof Text)){let r=s,l;for(;!r.length&&(l=r.previousSibling)&&l instanceof Text;)r.remove(),r=l;n=r,t=r.data.length}break}n=s,t=0}if(o)for(;!(e instanceof Text);){let s=e.childNodes[o-1];if(!s||F(s)){if(s&&s.nodeName==="BR"&&!te(s,!1)){o-=1;continue}break}e=s,o=B(e)}else for(;!(e instanceof Text);){let s=e.firstChild;if(!s||F(s))break;e=s}i.setStart(n,t),i.setEnd(e,o)},K=(i,n,t,e)=>{let o=i.startContainer,s=i.startOffset,r=i.endContainer,l=i.endOffset,a;for(n||(n=i.commonAncestorContainer),t||(t=n);!s&&o!==n&&o!==e;)a=o.parentNode,s=Array.from(a.childNodes).indexOf(o),o=a;for(;!(r===t||r===e||(r.nodeType!==3&&r.childNodes[l]&&r.childNodes[l].nodeName==="BR"&&!te(r.childNodes[l],!1)&&(l+=1),l!==B(r)));)a=r.parentNode,l=Array.from(a.childNodes).indexOf(r)+1,r=a;i.setStart(o,s),i.setEnd(r,l)},xe=(i,n,t)=>{let e=S(i.endContainer,t,n);if(e&&(e=e.parentNode)){let o=i.cloneRange();K(o,e,e,t),o.endContainer===e&&(i.setStart(o.endContainer,o.endOffset),i.setEnd(o.endContainer,o.endOffset))}return i};var v=i=>{let{cantFocusEmptyTextNodes:n}=U(),t=null;if(i instanceof Text)return i;if(g(i)){let e=i.firstChild;if(n)for(;e&&e instanceof Text&&!e.data;)i.removeChild(e),e=i.firstChild;e||(n?t=document.createTextNode(y):t=document.createTextNode(""))}else if(i instanceof Element&&!i.querySelector("BR")){t=N("BR");let e=i,o;for(;(o=e.lastElementChild)&&!g(o);)e=o}if(t)try{i.appendChild(t)}catch(e){}return i},A=(i,n)=>{let t=null;return Array.from(i.childNodes).forEach(e=>{let o=e.nodeName==="BR";!o&&g(e)?(t||(t=N("DIV")),t.appendChild(e)):(o||t)&&(t||(t=N("DIV")),v(t),o?i.replaceChild(t,e):i.insertBefore(t,e),t=null),$(e)&&A(e,n)}),t&&i.appendChild(v(t)),i},w=(i,n,t,e)=>{if(i instanceof Text&&i!==t){if(typeof n!="number")throw new Error("Offset must be a number to split text node!");if(!i.parentNode)throw new Error("Cannot split text node with no parent!");return w(i.parentNode,i.splitText(n),t,e)}let o=typeof n=="number"?n<i.childNodes.length?i.childNodes[n]:null:n,s=i.parentNode;if(!s||i===t||!(i instanceof Element))return o;let r=i.cloneNode(!1);for(;o;){let l=o.nextSibling;r.appendChild(o),o=l}return i instanceof HTMLOListElement&&S(i,e,"BLOCKQUOTE")&&(r.start=(+i.start||1)+i.childNodes.length-1),v(i),v(r),s.insertBefore(r,i.nextSibling),w(s,r,t,e)},Ie=(i,n)=>{let t=i.childNodes,e=t.length,o=[];for(;e--;){let s=t[e],r=e?t[e-1]:null;if(r&&g(s)&&Ce(s,r))n.startContainer===s&&(n.startContainer=r,n.startOffset+=B(r)),n.endContainer===s&&(n.endContainer=r,n.endOffset+=B(r)),n.startContainer===i&&(n.startOffset>e?n.startOffset-=1:n.startOffset===e&&(n.startContainer=r,n.startOffset=B(r))),n.endContainer===i&&(n.endOffset>e?n.endOffset-=1:n.endOffset===e&&(n.endContainer=r,n.endOffset=B(r))),_(s),s instanceof Text?r.appendData(s.data):o.push(C(s));else if(s instanceof Element){let l;for(;l=o.pop();)s.appendChild(l);Ie(s,n)}}},ne=(i,n)=>{let t=i instanceof Text?i.parentNode:i;if(t instanceof Element){let e={startContainer:n.startContainer,startOffset:n.startOffset,endContainer:n.endContainer,endOffset:n.endOffset};Ie(t,e),n.setStart(e.startContainer,e.startOffset),n.setEnd(e.endContainer,e.endOffset)}},ee=(i,n,t,e)=>{let o=n,s,r;for(;(s=o.parentNode)&&s!==e&&s instanceof Element&&s.childNodes.length===1;)o=s;_(o),r=i.childNodes.length;let l=i.lastChild;l&&l.nodeName==="BR"&&(i.removeChild(l),r-=1),i.appendChild(C(n)),t.setStart(i,r),t.collapse(!0),ne(i,t)},H=(i,n)=>{let t=i.previousSibling,e=i.firstChild,o=i.nodeName==="LI";if(!(o&&(!e||!/^[OU]L$/.test(e.nodeName)))){if(t&&Ce(t,i)){if(!$(t))if(o){let r=N("DIV");r.appendChild(C(t)),t.appendChild(r)}else return;_(i);let s=!$(i);t.appendChild(C(i)),s&&A(t,n),e&&H(e,n)}else if(o){let s=N("DIV");i.insertBefore(s,e),v(s)}}};var Me={"font-weight":{regexp:/^bold|^700/i,replace(){return N("B")}},"font-style":{regexp:/^italic/i,replace(){return N("I")}},"font-family":{regexp:M,replace(i,n){return N("SPAN",{class:i.fontFamily,style:"font-family:"+n})}},"font-size":{regexp:M,replace(i,n){return N("SPAN",{class:i.fontSize,style:"font-size:"+n})}},"text-decoration":{regexp:/^underline/i,replace(){return N("U")}}},at=(i,n,t)=>{let e=i.style,o,s;for(let r in Me){let l=Me[r],a=e.getPropertyValue(r);if(a&&l.regexp.test(a)){let d=l.replace(t.classNames,a);if(d.nodeName===i.nodeName&&d.className===i.className)continue;s||(s=d),o&&o.appendChild(d),o=d,i.style.removeProperty(r)}}return s&&o&&(o.appendChild(C(i)),i.style.cssText?i.appendChild(s):k(i,s)),o||i},fe=i=>(n,t)=>{let e=N(i),o=n.attributes;for(let s=0,r=o.length;s<r;s+=1){let l=o[s];e.setAttribute(l.name,l.value)}return t.replaceChild(e,n),e.appendChild(C(n)),e},ct={1:"10",2:"13",3:"16",4:"18",5:"24",6:"32",7:"48"},dt={STRONG:fe("B"),EM:fe("I"),INS:fe("U"),STRIKE:fe("S"),SPAN:at,FONT:(i,n,t)=>{let e=i,o=e.face,s=e.size,r=e.color,l=t.classNames,a,d,c,u,f;return o&&(a=N("SPAN",{class:l.fontFamily,style:"font-family:"+o}),f=a,u=a),s&&(d=N("SPAN",{class:l.fontSize,style:"font-size:"+ct[s]+"px"}),f||(f=d),u&&u.appendChild(d),u=d),r&&/^#?([\dA-F]{3}){1,2}$/i.test(r)&&(r.charAt(0)!=="#"&&(r="#"+r),c=N("SPAN",{class:l.color,style:"color:"+r}),f||(f=c),u&&u.appendChild(c),u=c),(!f||!u)&&(f=u=N("SPAN")),n.replaceChild(f,e),u.appendChild(C(e)),u},TT:(i,n,t)=>{let e=N("SPAN",{class:t.classNames.fontFamily,style:'font-family:menlo,consolas,"courier new",monospace'});return n.replaceChild(e,i),e.appendChild(C(i)),e}},ft=/^(?:A(?:DDRESS|RTICLE|SIDE|UDIO)|BLOCKQUOTE|CAPTION|D(?:[DLT]|IV)|F(?:IGURE|IGCAPTION|OOTER)|H[1-6]|HEADER|L(?:ABEL|EGEND|I)|O(?:L|UTPUT)|P(?:RE)?|SECTION|T(?:ABLE|BODY|D|FOOT|H|HEAD|R)|COL(?:GROUP)?|UL)$/,ut=/^(?:HEAD|META|STYLE)/,ue=(i,n,t)=>{let e=i.childNodes,o=i;for(;g(o);)o=o.parentNode;let s=new T(o,5);for(let r=0,l=e.length;r<l;r+=1){let a=e[r],d=a.nodeName,c=dt[d];if(a instanceof HTMLElement){let u=a.childNodes.length;if(c)a=c(a,i,n);else if(ut.test(d)){i.removeChild(a),r-=1,l-=1;continue}else if(!ft.test(d)&&!g(a)){r-=1,l+=u-1,i.replaceChild(C(a),a);continue}u&&ue(a,n,t||d==="PRE")}else{if(a instanceof Text){let u=a.data,f=!M.test(u.charAt(0)),m=!M.test(u.charAt(u.length-1));if(t||!f&&!m)continue;if(f){s.currentNode=a;let p;for(;(p=s.previousPONode())&&!(p.nodeName==="IMG"||p instanceof Text&&M.test(p.data));)if(!g(p)){p=null;break}u=u.replace(/^[ \t\r\n]+/g,p?" ":"")}if(m){s.currentNode=a;let p;for(;(p=s.nextNode())&&!(p.nodeName==="IMG"||p instanceof Text&&M.test(p.data));)if(!g(p)){p=null;break}u=u.replace(/[ \t\r\n]+$/g,p?" ":"")}if(u){a.data=u;continue}}i.removeChild(a),r-=1,l-=1}}return i},he=i=>{let n=i.childNodes,t=n.length;for(;t--;){let e=n[t];e instanceof Element&&!F(e)?(he(e),g(e)&&!e.firstChild&&i.removeChild(e)):e instanceof Text&&!e.data&&i.removeChild(e)}},se=(i,n,t)=>{let e=i.querySelectorAll("BR"),o=[],s=e.length;for(let r=0;r<s;r+=1)o[r]=te(e[r],t);for(;s--;){let r=e[s],l=r.parentNode;l&&(o[s]?g(l)||A(l,n):_(r))}},be=i=>i.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;");var re=(i,n)=>{let t=new T(n,1,q);return t.currentNode=i,t},Z=(i,n)=>{let t=re(i,n).previousNode();return t!==n?t:null},z=(i,n)=>{let t=re(i,n).nextNode();return t!==n?t:null},le=i=>!i.textContent&&!i.querySelector("IMG");var L=(i,n)=>{let t=i.startContainer,e;if(g(t))e=Z(t,n);else if(t!==n&&t instanceof HTMLElement&&q(t))e=t;else{let o=de(t,i.startOffset);e=z(o,n)}return e&&G(i,e,!0)?e:null},j=(i,n)=>{let t=i.endContainer,e;if(g(t))e=Z(t,n);else if(t!==n&&t instanceof HTMLElement&&q(t))e=t;else{let o=_e(t,i.endOffset);if(!o||!n.contains(o)){o=n;let s;for(;s=o.lastChild;)o=s}e=Z(o,n)}return e&&G(i,e,!0)?e:null},Fe=i=>i instanceof Text?M.test(i.data):i.nodeName==="IMG",V=(i,n)=>{let t=i.startContainer,e=i.startOffset,o;if(t instanceof Text){let l=t.data;for(let a=e;a>0;a-=1)if(l.charAt(a-1)!==y)return!1;o=t}else if(o=_e(t,e),o&&!n.contains(o)&&(o=null),!o&&(o=de(t,e),o instanceof Text&&o.length))return!1;let s=L(i,n);if(!s)return!1;let r=new T(s,5,Fe);return r.currentNode=o,!r.previousNode()},Q=(i,n)=>{let t=i.endContainer,e=i.endOffset,o;if(t instanceof Text){let l=t.data,a=l.length;for(let d=e;d<a;d+=1)if(l.charAt(d)!==y)return!1;o=t}else o=de(t,e);let s=j(i,n);if(!s)return!1;let r=new T(s,5,Fe);return r.currentNode=o,!r.nextNode()},ve=(i,n)=>{let t=L(i,n),e=j(i,n),o;t&&e&&(o=t.parentNode,i.setStart(o,Array.from(o.childNodes).indexOf(t)),o=e.parentNode,i.setEnd(o,Array.from(o.childNodes).indexOf(e)+1))};function Y(i,n,t,e){let o=document.createRange();return o.setStart(i,n),t&&typeof e=="number"?o.setEnd(t,e):o.setEnd(i,n),o}var X=(i,n)=>{let{startContainer:t,startOffset:e,endContainer:o,endOffset:s}=i,r;if(t instanceof Text){let a=t.parentNode;if(r=a.childNodes,e===t.length)e=Array.from(r).indexOf(t)+1,i.collapsed&&(o=a,s=e);else{if(e){let d=t.splitText(e);o===t?(s-=e,o=d):o===a&&(s+=1),t=d}e=Array.from(r).indexOf(t)}t=a}else r=t.childNodes;let l=r.length;e===l?t.appendChild(n):t.insertBefore(n,r[e]),t===o&&(s+=r.length-l),i.setStart(t,e),i.setEnd(o,s)},Le=(i,n,t)=>{let e=document.createDocumentFragment();if(i.collapsed)return e;n||(n=i.commonAncestorContainer),n instanceof Text&&(n=n.parentNode);let o=i.startContainer,s=i.startOffset,r=w(i.endContainer,i.endOffset,n,t),l=0,a=w(o,s,n,t);for(;a&&a!==r;){let d=a.nextSibling;e.appendChild(a),a=d}return o instanceof Text&&r instanceof Text&&(o.appendData(r.data),_(r),r=o,l=s),i.setStart(o,s),r?i.setEnd(r,l):i.setEnd(n,n.childNodes.length),v(n),e},He=(i,n,t)=>{i.currentNode=t;let e;for(;e=i[n]();){if(e instanceof Text||F(e))return e;if(!g(e))return null}return null},P=(i,n)=>{let t=L(i,n),e=j(i,n),o=t!==e;t&&e&&(x(i),K(i,t,e,n));let s=Le(i,null,n);x(i),o&&(e=j(i,n),t&&e&&t!==e&&ee(t,e,i,n)),t&&v(t);let r=n.firstChild;(!r||r.nodeName==="BR")&&(v(n),n.firstChild&&i.selectNodeContents(n.firstChild)),i.collapse(!0);let l=i.startContainer,a=i.startOffset,d=new T(n,5),c=l,u=a;(!(c instanceof Text)||u===c.data.length)&&(c=He(d,"nextNode",c),u=0);let f=l,m=a-1;(!(f instanceof Text)||m===-1)&&(f=He(d,"previousPONode",c||(l instanceof Text?l:l.childNodes[a]||l)),f instanceof Text&&(m=f.data.length));let p=null,h=0;return c instanceof Text&&c.data.charAt(u)===" "&&V(i,n)?(p=c,h=u):f instanceof Text&&f.data.charAt(m)===" "&&(c instanceof Text&&c.data.charAt(u)===" "||Q(i,n))&&(p=f,h=m),p&&p.replaceData(h,1,"\xA0"),i.setStart(l,a),i.collapse(!0),s},Pe=(i,n,t)=>{let e=n.firstChild&&g(n.firstChild),o;for(A(n,t),o=n;o=z(o,t);)v(o);i.collapsed||P(i,t),x(i),i.collapse(!1);let s=S(i.endContainer,t,"BLOCKQUOTE")||t,r=L(i,t),l=null,a=z(n,n),d=!e&&!!r&&le(r);if(r&&a&&!d&&!S(a,n,"PRE")&&!S(a,n,"TABLE")){K(i,r,r,t),i.collapse(!0);let c=i.endContainer,u=i.endOffset;if(se(r,t,!1),g(c)){let f=w(c,u,Z(c,t)||t,t);c=f.parentNode,u=Array.from(c.childNodes).indexOf(f)}if(u!==B(c))for(l=document.createDocumentFragment();o=c.childNodes[u];)l.appendChild(o);ee(c,a,i,t),u=Array.from(c.parentNode.childNodes).indexOf(c)+1,c=c.parentNode,i.setEnd(c,u)}if(B(n)){d&&r&&(i.setEndBefore(r),i.collapse(!1),_(r)),K(i,s,s,t);let c=w(i.endContainer,i.endOffset,s,t),u=c?c.previousSibling:s.lastChild;s.insertBefore(n,c),c?i.setEndBefore(c):i.setEnd(s,B(s)),r=j(i,t),x(i);let f=i.endContainer,m=i.endOffset;c&&$(c)&&H(c,t),c=u&&u.nextSibling,c&&$(c)&&H(c,t),i.setEnd(f,m)}if(l&&r){let c=i.cloneRange();ee(r,l,c,t),i.setEnd(c.endContainer,c.endOffset)}x(i)};var me=i=>{if(i.collapsed)return"";let n=i.startContainer,t=i.endContainer,e=new T(i.commonAncestorContainer,5,a=>G(i,a,!0));e.currentNode=n;let o=n,s="",r=!1,l;for((!(o instanceof Element)&&!(o instanceof Text)||!e.filter(o))&&(o=e.nextNode());o;)o instanceof Text?(l=o.data,l&&/\S/.test(l)&&(o===t&&(l=l.slice(0,i.endOffset)),o===n&&(l=l.slice(i.startOffset)),s+=l,r=!0)):(o.nodeName==="BR"||r&&!g(o))&&(s+=`
`,r=!1),o=e.nextNode();return s=s.replace(/ /g," "),s};var Re=Array.prototype.indexOf,Ue=(i,n,t,e,o,s,r)=>{let{isLegacyEdge:l,isWin:a}=U(),d=i.clipboardData;if(l||!d)return!1;let c=s?"":me(n),u=L(n,t),f=j(n,t),m=t;u===f&&(u!=null&&u.contains(n.commonAncestorContainer))&&(m=u);let p;e?p=P(n,t):(n=n.cloneRange(),x(n),K(n,m,m,t),p=n.cloneContents());let h=n.commonAncestorContainer;for(h instanceof Text&&(h=h.parentNode);h&&h!==m;){let b=h.cloneNode(!1);b.appendChild(p),p=b,h=h.parentNode}let R;if(p.childNodes.length===1&&p.childNodes[0]instanceof Text)c=p.childNodes[0].data.replace(/ /g," "),r=!0;else{let b=N("DIV");b.appendChild(p),R=b.innerHTML,o&&(R=o(R))}return s&&R!==void 0&&(c=s(R)),a&&(c=c.replace(/\r?\n/g,`\r
`)),!r&&R&&c!==R&&d.setData("text/html",R),d.setData("text/plain",c),i.preventDefault(),!0},qe=function(i){let n=this.getSelection(),t=this._root;if(n.collapsed){i.preventDefault();return}this.saveUndoState(n),Ue(i,n,t,!0,this._config.willCutCopy,this._config.toPlainText,!1)||setTimeout(()=>{try{this._ensureBottomLine()}catch(o){this._config.didError(o)}},0),this.setSelection(n)},We=function(i){Ue(i,this.getSelection(),this._root,!1,this._config.willCutCopy,this._config.toPlainText,!1)},Oe=function(i){this._isShiftDown=i.shiftKey},Ke=function(i){let{isLegacyEdge:n,isGecko:t}=U(),e=i.clipboardData,o=e==null?void 0:e.items,s=this._isShiftDown,r=!1,l=!1,a=null,d=null;if(o){let O=o.length;for(;O--;){let I=o[O],D=I.type;D==="text/html"?d=I:D==="text/plain"||D==="text/uri-list"?a=I:D==="text/rtf"?r=!0:/^image\/.*/.test(D)&&(l=!0)}if(l&&!(r&&d)){i.preventDefault(),this.fireEvent("pasteImage",{clipboardData:e});return}if(!n){i.preventDefault(),d&&(!s||!a)?d.getAsString(I=>{this.insertHTML(I,!0)}):a&&a.getAsString(I=>{let D=!1,ye=this.getSelection();if(!ye.collapsed&&M.test(ye.toString())){let Be=this.linkRegExp.exec(I);D=!!Be&&Be[0].length===I.length}D?this.makeLink(I):this.insertPlainText(I,!0)});return}}let c=e==null?void 0:e.types;if(!n&&c&&(Re.call(c,"text/html")>-1||!t&&Re.call(c,"text/plain")>-1&&Re.call(c,"text/rtf")<0)){i.preventDefault();let O;!s&&(O=e.getData("text/html"))?this.insertHTML(O,!0):((O=e.getData("text/plain"))||(O=e.getData("text/uri-list")))&&this.insertPlainText(O,!0);return}let u=document.body,f=this.getSelection(),m=f.startContainer,p=f.startOffset,h=f.endContainer,R=f.endOffset,b=N("DIV",{contenteditable:"true",style:"position:fixed; overflow:hidden; top:0; right:100%; width:1px; height:1px;"});u.appendChild(b),f.selectNodeContents(b),this.setSelection(f),setTimeout(()=>{try{let O="",I=b,D;for(;b=I;)I=b.nextSibling,_(b),D=b.firstChild,D&&D===b.lastChild&&D instanceof HTMLDivElement&&(b=D),O+=b.innerHTML;this.setSelection(Y(m,p,h,R)),O&&this.insertHTML(O,!0)}catch(O){this._config.didError(O)}},0)},ze=function(i){if(!i.dataTransfer)return;let n=i.dataTransfer.types,t=n.length,e=!1,o=!1;for(;t--;)switch(n[t]){case"text/plain":e=!0;break;case"text/html":o=!0;break;default:return}(o||e&&this.saveUndoState)&&this.saveUndoState()};var ke=(i,n,t)=>{n.preventDefault(),i.splitBlock(n.shiftKey,t)};var oe=(i,n)=>{try{n||(n=i.getSelection());let t=n.startContainer;t instanceof Text&&(t=t.parentNode);let e=t;for(;g(e)&&(!e.textContent||e.textContent===y);)t=e,e=t.parentNode;t!==e&&(n.setStart(e,Array.from(e.childNodes).indexOf(t)),n.collapse(!0),e.removeChild(t),q(e)||(e=Z(e,i._root)||i._root),v(e),x(n)),t===i._root&&(t=t.firstChild)&&t.nodeName==="BR"&&_(t),i._ensureBottomLine(),i.setSelection(n),i._updatePath(n,!0)}catch(t){i._config.didError(t)}},pe=(i,n)=>{let t;for(;(t=i.parentNode)&&!(t===n||t.isContentEditable);)i=t;_(i)},Ne=(i,n,t)=>{if(S(n,i._root,"A"))return;let e=n.data||"",o=Math.max(e.lastIndexOf(" ",t-1),e.lastIndexOf("\xA0",t-1))+1,s=e.slice(o,t),r=i.linkRegExp.exec(s);if(r){let l=i.getSelection();i._docWasChanged(),i._recordUndoState(l),i._getRangeAndRemoveBookmark(l);let a=o+r.index,d=a+r[0].length,c=l.startContainer===n,u=l.startOffset-d;a&&(n=n.splitText(a));let f=i._config.tagAttributes.a,m=N("A",Object.assign({href:r[1]?/^(?:ht|f)tps?:/i.test(r[1])?r[1]:"http://"+r[1]:"mailto:"+r[0]},f));m.textContent=e.slice(a,d),n.parentNode.insertBefore(m,n),n.data=e.slice(d),c&&(l.setStart(n,u),l.setEnd(n,u)),i.setSelection(l)}};var Ge=(i,n,t)=>{let e=i._root;if(i._removeZWS(),i.saveUndoState(t),!t.collapsed)n.preventDefault(),P(t,e),oe(i,t);else if(V(t,e)){n.preventDefault();let o=L(t,e);if(!o)return;let s=o;A(s.parentNode,e);let r=Z(s,e);if(r){if(!r.isContentEditable){pe(r,e);return}for(ee(r,s,t,e),s=r.parentNode;s!==e&&!s.nextSibling;)s=s.parentNode;s!==e&&(s=s.nextSibling)&&H(s,e),i.setSelection(t)}else if(s){if(S(s,e,"UL")||S(s,e,"OL")){i.decreaseListLevel(t);return}else if(S(s,e,"BLOCKQUOTE")){i.removeQuote(t);return}i.setSelection(t),i._updatePath(t,!0)}}else{x(t);let o=t.startContainer,s=t.startOffset,r=o.parentNode;o instanceof Text&&r instanceof HTMLAnchorElement&&s&&r.href.includes(o.data)?(o.deleteData(s-1,1),i.setSelection(t),i.removeLink(),n.preventDefault()):(i.setSelection(t),setTimeout(()=>{oe(i)},0))}};var Ze=(i,n,t)=>{let e=i._root,o,s,r,l,a,d;if(i._removeZWS(),i.saveUndoState(t),!t.collapsed)n.preventDefault(),P(t,e),oe(i,t);else if(Q(t,e)){if(n.preventDefault(),o=L(t,e),!o)return;if(A(o.parentNode,e),s=z(o,e),s){if(!s.isContentEditable){pe(s,e);return}for(ee(o,s,t,e),s=o.parentNode;s!==e&&!s.nextSibling;)s=s.parentNode;s!==e&&(s=s.nextSibling)&&H(s,e),i.setSelection(t),i._updatePath(t,!0)}}else{if(r=t.cloneRange(),K(t,e,e,e),l=t.endContainer,a=t.endOffset,l instanceof Element&&(d=l.childNodes[a],d&&d.nodeName==="IMG")){n.preventDefault(),_(d),x(t),oe(i,t);return}i.setSelection(r),setTimeout(()=>{oe(i)},0)}};var je=(i,n,t)=>{let e=i._root;if(i._removeZWS(),t.collapsed&&V(t,e)){let o=L(t,e),s;for(;s=o.parentNode;){if(s.nodeName==="UL"||s.nodeName==="OL"){n.preventDefault(),i.increaseListLevel(t);break}o=s}}},Qe=(i,n,t)=>{let e=i._root;if(i._removeZWS(),t.collapsed&&V(t,e)){let o=t.startContainer;(S(o,e,"UL")||S(o,e,"OL"))&&(n.preventDefault(),i.decreaseListLevel(t))}};var Xe=(i,n,t)=>{var r;let{cantFocusEmptyTextNodes:e}=U(),o,s=i._root;if(i._recordUndoState(t),i._getRangeAndRemoveBookmark(t),!t.collapsed)P(t,s),i._ensureBottomLine(),i.setSelection(t),i._updatePath(t,!0);else if(Q(t,s)){let l=L(t,s);if(l&&l.nodeName!=="PRE"){let a=(r=l.textContent)==null?void 0:r.trimEnd().replace(y,"");if(a==="*"||a==="1."){n.preventDefault();let d=new T(l,4),c;for(;c=d.nextNode();)c.data=e?y:"";a==="*"?i.makeUnorderedList():i.makeOrderedList();return}}}if(o=t.endContainer,t.endOffset===B(o))do if(o.nodeName==="A"){t.setStartAfter(o);break}while(!o.nextSibling&&(o=o.parentNode)&&o!==s);if(i._config.addLinks){let l=t.cloneRange();x(l);let a=l.startContainer,d=l.startOffset;setTimeout(()=>{Ne(i,a,d)},0)}i.setSelection(t)};var mt={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",32:"Space",33:"PageUp",34:"PageDown",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",46:"Delete",191:"/",219:"[",220:"\\",221:"]"};function $e(){let{isWin:i,ctrlKey:n,supportsInputEvents:t,isIOS:e,isMac:o}=U(),s=function(a){let d=a.keyCode,c=mt[d],u="",f=this.getSelection();a.defaultPrevented||(c||(c=String.fromCharCode(d).toLowerCase(),/^[A-Za-z0-9]$/.test(c)||(c="")),111<d&&d<124&&(c="F"+(d-111)),c!=="Backspace"&&c!=="Delete"&&(a.altKey&&(u+="Alt-"),a.ctrlKey&&(u+="Ctrl-"),a.metaKey&&(u+="Meta-"),a.shiftKey&&(u+="Shift-")),i&&a.shiftKey&&c==="Delete"&&(u+="Shift-"),c=u+c,this._keyHandlers[c]?this._keyHandlers[c](this,a,f):!f.collapsed&&!a.isComposing&&!a.ctrlKey&&!a.metaKey&&(a.key||c).length===1&&(this.saveUndoState(f),P(f,this._root),this._ensureBottomLine(),this.setSelection(f),this._updatePath(f,!0)))},r={Backspace:Ge,Delete:Ze,Tab:je,"Shift-Tab":Qe,Space:Xe,ArrowLeft(a){a._removeZWS()},ArrowRight(a,d,c){a._removeZWS();let u=a.getRoot();if(Q(c,u)){x(c);let f=c.endContainer;do if(f.nodeName==="CODE"){let m=f.nextSibling;if(!(m instanceof Text)){let p=document.createTextNode("\xA0");f.parentNode.insertBefore(p,m),m=p}c.setStart(m,1),a.setSelection(c),d.preventDefault();break}while(!f.nextSibling&&(f=f.parentNode)&&f!==u)}}};t||(r.Enter=ke,r["Shift-Enter"]=ke),!o&&!e&&(r.PageUp=a=>{a.moveCursorToStart()},r.PageDown=a=>{a.moveCursorToEnd()});let l=(a,d)=>(d=d||null,(c,u)=>{u.preventDefault();let f=c.getSelection();c.hasFormat(a,null,f)?c.changeFormat(null,{tag:a},f):c.changeFormat({tag:a},d,f)});return r[n+"b"]=l("B"),r[n+"i"]=l("I"),r[n+"u"]=l("U"),r[n+"Shift-7"]=l("S"),r[n+"Shift-5"]=l("SUB",{tag:"SUP"}),r[n+"Shift-6"]=l("SUP",{tag:"SUB"}),r[n+"Shift-8"]=(a,d)=>{d.preventDefault();let c=a.getPath();/(?:^|>)UL/.test(c)?a.removeList():a.makeUnorderedList()},r[n+"Shift-9"]=(a,d)=>{d.preventDefault();let c=a.getPath();/(?:^|>)OL/.test(c)?a.removeList():a.makeOrderedList()},r[n+"["]=(a,d)=>{d.preventDefault();let c=a.getPath();/(?:^|>)BLOCKQUOTE/.test(c)||!/(?:^|>)[OU]L/.test(c)?a.decreaseQuoteLevel():a.decreaseListLevel()},r[n+"]"]=(a,d)=>{d.preventDefault();let c=a.getPath();/(?:^|>)BLOCKQUOTE/.test(c)||!/(?:^|>)[OU]L/.test(c)?a.increaseQuoteLevel():a.increaseListLevel()},r[n+"d"]=(a,d)=>{d.preventDefault(),a.toggleCode()},r[n+"z"]=(a,d)=>{d.preventDefault(),a.undo()},r[n+"y"]=r[n+"Shift-z"]=(a,d)=>{d.preventDefault(),a.redo()},{_onKey:s,keyHandlers:r}}var ge=class{constructor(n,t){this.customEvents=new Set(["pathChange","select","input","pasteImage","undoStateChange"]);this.startSelectionId="squire-selection-start";this.endSelectionId="squire-selection-end";this.linkRegExp=/\b(?:((?:(?:ht|f)tps?:\/\/|www\d{0,3}[.]|[a-z0-9][a-z0-9.\-]*[.][a-z]{2,}\/)(?:[^\s()<>]+|\([^\s()<>]+\))+(?:[^\s?&`!()\[\]{};:'".,<>«»“”‘’]|\([^\s()<>]+\)))|([\w\-.%+]+@(?:[\w\-]+\.)+[a-z]{2,}\b(?:[?][^&?\s]+=[^\s?&`!()\[\]{};:'".,<>«»“”‘’]+(?:&[^&?\s]+=[^\s?&`!()\[\]{};:'".,<>«»“”‘’]+)*)?))/i;this.tagAfterSplit={DT:"DD",DD:"DT",LI:"LI",PRE:"PRE"};this._root=n,this._config=this._makeConfig(t),this._isFocused=!1,this._lastSelection=Y(n,0),this._willRestoreSelection=!1,this._mayHaveZWS=!1,this._lastAnchorNode=null,this._lastFocusNode=null,this._path="",this._events=new Map,this._undoIndex=-1,this._undoStack=[],this._undoStackLength=0,this._isInUndoState=!1,this._ignoreChange=!1,this._ignoreAllChanges=!1,this.addEventListener("selectionchange",this._updatePathOnEvent),this.addEventListener("blur",this._enableRestoreSelection),this.addEventListener("mousedown",this._disableRestoreSelection),this.addEventListener("touchstart",this._disableRestoreSelection),this.addEventListener("focus",this._restoreSelection),this._isShiftDown=!1,this.addEventListener("cut",qe),this.addEventListener("copy",We),this.addEventListener("paste",Ke),this.addEventListener("drop",ze),this.addEventListener("keydown",Oe),this.addEventListener("keyup",Oe);let{_onKey:e,keyHandlers:o}=$e();this.addEventListener("keydown",e),this._keyHandlers=Object.create(o);let s=new MutationObserver(()=>this._docWasChanged());s.observe(n,{childList:!0,attributes:this._config.watchRootAttributes,characterData:!0,subtree:!0}),this._mutation=s,n.setAttribute("contenteditable","true"),this.addEventListener("beforeinput",this._beforeInput),this.setHTML("")}destroy(){this._events.forEach((n,t)=>{this.removeEventListener(t)}),this._mutation.disconnect(),this._undoIndex=-1,this._undoStack=[],this._undoStackLength=0}_makeConfig(n){let t={blockTag:"DIV",blockAttributes:null,tagAttributes:{},watchRootAttributes:!0,classNames:{color:"color",fontFamily:"font",fontSize:"size",highlight:"highlight",align:"align"},undo:{documentSizeThreshold:-1,undoLimit:-1},addLinks:!0,willCutCopy:null,toPlainText:null,sanitizeToDOMFragment:e=>{let o=DOMPurify.sanitize(e,{ALLOW_UNKNOWN_PROTOCOLS:!0,WHOLE_DOCUMENT:!1,RETURN_DOM:!0,RETURN_DOM_FRAGMENT:!0,FORCE_BODY:!1});return o?document.importNode(o,!0):document.createDocumentFragment()},didError:e=>console.log(e)};return n&&(Object.assign(t,n),t.blockTag=t.blockTag.toUpperCase()),t}setKeyHandler(n,t){return this._keyHandlers[n]=t,this}_beforeInput(n){let{isAndroid:t}=U();switch(n.inputType){case"insertText":t&&n.data&&n.data.includes(`
`)&&n.preventDefault();break;case"insertLineBreak":n.preventDefault(),this.splitBlock(!0);break;case"insertParagraph":n.preventDefault(),this.splitBlock(!1);break;case"insertOrderedList":n.preventDefault(),this.makeOrderedList();break;case"insertUnoderedList":n.preventDefault(),this.makeUnorderedList();break;case"historyUndo":n.preventDefault(),this.undo();break;case"historyRedo":n.preventDefault(),this.redo();break;case"formatBold":n.preventDefault(),this.bold();break;case"formaItalic":n.preventDefault(),this.italic();break;case"formatUnderline":n.preventDefault(),this.underline();break;case"formatStrikeThrough":n.preventDefault(),this.strikethrough();break;case"formatSuperscript":n.preventDefault(),this.superscript();break;case"formatSubscript":n.preventDefault(),this.subscript();break;case"formatJustifyFull":case"formatJustifyCenter":case"formatJustifyRight":case"formatJustifyLeft":{n.preventDefault();let e=n.inputType.slice(13).toLowerCase();e==="full"&&(e="justify"),this.setTextAlignment(e);break}case"formatRemove":n.preventDefault(),this.removeAllFormatting();break;case"formatSetBlockTextDirection":{n.preventDefault();let e=n.data;e==="null"&&(e=null),this.setTextDirection(e);break}case"formatBackColor":n.preventDefault(),this.setHighlightColor(n.data);break;case"formatFontColor":n.preventDefault(),this.setTextColor(n.data);break;case"formatFontName":n.preventDefault(),this.setFontFace(n.data);break}}handleEvent(n){this.fireEvent(n.type,n)}fireEvent(n,t){let e=this._events.get(n);if(/^(?:focus|blur)/.test(n)){let o=this._root===document.activeElement;if(n==="focus"){if(!o||this._isFocused)return this;this._isFocused=!0}else{if(o||!this._isFocused)return this;this._isFocused=!1}}if(e){let o=t instanceof Event?t:new CustomEvent(n,{detail:t});e=e.slice();for(let s of e)try{"handleEvent"in s?s.handleEvent(o):s.call(this,o)}catch(r){this._config.didError(r)}}return this}addEventListener(n,t){let e=this._events.get(n),o=this._root;return e||(e=[],this._events.set(n,e),this.customEvents.has(n)||(n==="selectionchange"&&(o=document),o.addEventListener(n,this,!0))),e.push(t),this}removeEventListener(n,t){let e=this._events.get(n),o=this._root;if(e){if(t){let s=e.length;for(;s--;)e[s]===t&&e.splice(s,1)}else e.length=0;e.length||(this._events.delete(n),this.customEvents.has(n)||(n==="selectionchange"&&(o=document),o.removeEventListener(n,this,!0)))}return this}focus(){return this._root.focus({preventScroll:!0}),this}blur(){return this._root.blur(),this}_enableRestoreSelection(){this._willRestoreSelection=!0}_disableRestoreSelection(){this._willRestoreSelection=!1}_restoreSelection(){this._willRestoreSelection&&this.setSelection(this._lastSelection)}_removeZWS(){this._mayHaveZWS&&(ie(this._root),this._mayHaveZWS=!1)}_saveRangeToBookmark(n){let t=N("INPUT",{id:this.startSelectionId,type:"hidden"}),e=N("INPUT",{id:this.endSelectionId,type:"hidden"}),o;X(n,t),n.collapse(!1),X(n,e),t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_PRECEDING&&(t.id=this.endSelectionId,e.id=this.startSelectionId,o=t,t=e,e=o),n.setStartAfter(t),n.setEndBefore(e)}_getRangeAndRemoveBookmark(n){let t=this._root,e=t.querySelector("#"+this.startSelectionId),o=t.querySelector("#"+this.endSelectionId);if(e&&o){let s=e.parentNode,r=o.parentNode,l=Array.from(s.childNodes).indexOf(e),a=Array.from(r.childNodes).indexOf(o);s===r&&(a-=1),e.remove(),o.remove(),n||(n=document.createRange()),n.setStart(s,l),n.setEnd(r,a),ne(s,n),s!==r&&ne(r,n),n.collapsed&&(s=n.startContainer,s instanceof Text&&(r=s.childNodes[n.startOffset],(!r||!(r instanceof Text))&&(r=s.childNodes[n.startOffset-1]),r&&r instanceof Text&&(n.setStart(r,0),n.collapse(!0))))}return n||null}getSelection(){let n=window.getSelection(),t=this._root,e=null;if(this._isFocused&&n&&n.rangeCount){e=n.getRangeAt(0).cloneRange();let o=e.startContainer,s=e.endContainer;o&&F(o)&&e.setStartBefore(o),s&&F(s)&&e.setEndBefore(s)}return e&&t.contains(e.commonAncestorContainer)?this._lastSelection=e:(e=this._lastSelection,document.contains(e.commonAncestorContainer)||(e=null)),e||(e=Y(t.firstElementChild||t,0)),e}setSelection(n){if(this._lastSelection=n,!this._isFocused)this._enableRestoreSelection();else{let t=window.getSelection();t&&("setBaseAndExtent"in Selection.prototype?t.setBaseAndExtent(n.startContainer,n.startOffset,n.endContainer,n.endOffset):(t.removeAllRanges(),t.addRange(n)))}return this}_moveCursorTo(n){let t=this._root,e=Y(t,n?0:t.childNodes.length);return x(e),this.setSelection(e),this}moveCursorToStart(){return this._moveCursorTo(!0)}moveCursorToEnd(){return this._moveCursorTo(!1)}getCursorPosition(){let n=this.getSelection(),t=n.getBoundingClientRect();if(t&&!t.top){this._ignoreChange=!0;let e=N("SPAN");e.textContent=y,X(n,e),t=e.getBoundingClientRect();let o=e.parentNode;o.removeChild(e),ne(o,n)}return t}getPath(){return this._path}_updatePathOnEvent(){this._isFocused&&this._updatePath(this.getSelection())}_updatePath(n,t){let e=n.startContainer,o=n.endContainer,s;(t||e!==this._lastAnchorNode||o!==this._lastFocusNode)&&(this._lastAnchorNode=e,this._lastFocusNode=o,s=e&&o?e===o?this._getPath(o):"(selection)":"",this._path!==s&&(this._path=s,this.fireEvent("pathChange",{path:s}))),this.fireEvent(n.collapsed?"cursor":"select",{range:n})}_getPath(n){let t=this._root,e=this._config,o="";if(n&&n!==t){let s=n.parentNode;if(o=s?this._getPath(s):"",n instanceof HTMLElement){let r=n.id,l=n.classList,a=Array.from(l).sort(),d=n.dir,c=e.classNames;o+=(o?">":"")+n.nodeName,r&&(o+="#"+r),a.length&&(o+=".",o+=a.join(".")),d&&(o+="[dir="+d+"]"),l.contains(c.highlight)&&(o+="[backgroundColor="+n.style.backgroundColor.replace(/ /g,"")+"]"),l.contains(c.color)&&(o+="[color="+n.style.color.replace(/ /g,"")+"]"),l.contains(c.fontFamily)&&(o+="[fontFamily="+n.style.fontFamily.replace(/ /g,"")+"]"),l.contains(c.fontSize)&&(o+="[fontSize="+n.style.fontSize+"]")}}return o}modifyDocument(n){let t=this._mutation;return t&&(t.takeRecords().length&&this._docWasChanged(),t.disconnect()),this._ignoreAllChanges=!0,n(),this._ignoreAllChanges=!1,t&&(t.observe(this._root,{childList:!0,attributes:this._config.watchRootAttributes,characterData:!0,subtree:!0}),this._ignoreChange=!1),this}_docWasChanged(){if(we(),this._mayHaveZWS=!0,!this._ignoreAllChanges){if(this._ignoreChange){this._ignoreChange=!1;return}this._isInUndoState&&(this._isInUndoState=!1,this.fireEvent("undoStateChange",{canUndo:!0,canRedo:!1})),this.fireEvent("input")}}_recordUndoState(n,t){if(!this._isInUndoState||t){let e=this._undoIndex,o=this._undoStack,s=this._config.undo,r=s.documentSizeThreshold,l=s.undoLimit;t||(e+=1),e<this._undoStackLength&&(o.length=this._undoStackLength=e),n&&this._saveRangeToBookmark(n);let a=this._getRawHTML();r>-1&&a.length*2>r&&l>-1&&e>l&&(o.splice(0,e-l),e=l,this._undoStackLength=l),o[e]=a,this._undoIndex=e,this._undoStackLength+=1,this._isInUndoState=!0}return this}saveUndoState(n){return n||(n=this.getSelection()),this._recordUndoState(n,this._isInUndoState),this._getRangeAndRemoveBookmark(n),this}undo(){if(this._undoIndex!==0||!this._isInUndoState){this._recordUndoState(this.getSelection(),!1),this._undoIndex-=1,this._setRawHTML(this._undoStack[this._undoIndex]);let n=this._getRangeAndRemoveBookmark();n&&this.setSelection(n),this._isInUndoState=!0,this.fireEvent("undoStateChange",{canUndo:this._undoIndex!==0,canRedo:!0}),this.fireEvent("input")}return this.focus()}redo(){let n=this._undoIndex,t=this._undoStackLength;if(n+1<t&&this._isInUndoState){this._undoIndex+=1,this._setRawHTML(this._undoStack[this._undoIndex]);let e=this._getRangeAndRemoveBookmark();e&&this.setSelection(e),this.fireEvent("undoStateChange",{canUndo:!0,canRedo:n+2<t}),this.fireEvent("input")}return this.focus()}getRoot(){return this._root}_getRawHTML(){return this._root.innerHTML}_setRawHTML(n){let t=this._root;t.innerHTML=n;let e=t,o=e.firstChild;if(!o||o.nodeName==="BR"){let s=this.createDefaultBlock();o?e.replaceChild(s,o):e.appendChild(s)}else for(;e=z(e,t);)v(e);return this._ignoreChange=!0,this}getHTML(n){let t;n&&(t=this.getSelection(),this._saveRangeToBookmark(t));let e=this._getRawHTML().replace(/\u200B/g,"");return n&&this._getRangeAndRemoveBookmark(t),e}setHTML(n){let t=this._config.sanitizeToDOMFragment(n,this),e=this._root;ue(t,this._config),se(t,e,!1),A(t,e);let o=t,s=o.firstChild;if(!s||s.nodeName==="BR"){let l=this.createDefaultBlock();s?o.replaceChild(l,s):o.appendChild(l)}else for(;o=z(o,e);)v(o);for(this._ignoreChange=!0;s=e.lastChild;)e.removeChild(s);e.appendChild(t),this.clearUndoStack();let r=this._getRangeAndRemoveBookmark()||Y(e.firstElementChild||e,0);return this.saveUndoState(r),this.setSelection(r),this._updatePath(r,!0),this}clearUndoStack(){this._undoIndex=-1,this._undoStack.length=0,this._undoStackLength=0,this._isInUndoState=!1}insertHTML(n,t){let e=this._config,o=e.sanitizeToDOMFragment(n,this),s=this.getSelection();this.saveUndoState(s);try{let r=this._root;e.addLinks&&this.addDetectedLinks(o,o),ue(o,this._config),se(o,r,!1),he(o),o.normalize();let l=o;for(;l=z(l,o);)v(l);let a=!0;if(t){let d=new CustomEvent("willPaste",{detail:{fragment:o}});this.fireEvent("willPaste",d),o=d.detail.fragment,a=!d.defaultPrevented}a&&(Pe(s,o,r),s.collapse(!1),xe(s,"A",r),this._ensureBottomLine()),this.setSelection(s),this._updatePath(s,!0),t&&this.focus()}catch(r){this._config.didError(r)}return this}insertElement(n,t){if(t||(t=this.getSelection()),t.collapse(!0),g(n))X(t,n),t.setStartAfter(n);else{let e=this._root,o=L(t,e),s=o||e,r=null;for(;s!==e&&!s.nextSibling;)s=s.parentNode;if(s!==e){let a=s.parentNode;r=w(a,s.nextSibling,e,e)}o&&le(o)&&_(o),e.insertBefore(n,r);let l=this.createDefaultBlock();e.insertBefore(l,r),t.setStart(l,0),t.setEnd(l,0),x(t)}return this.focus(),this.setSelection(t),this._updatePath(t),this}insertImage(n,t){let e=N("IMG",Object.assign({src:n},t));return this.insertElement(e),e}insertPlainText(n,t){let e=this.getSelection();if(e.collapsed&&S(e.startContainer,this._root,"PRE")){let c=e.startContainer,u=e.startOffset,f;if(!c||!(c instanceof Text)){let p=document.createTextNode("");c.insertBefore(p,c.childNodes[u]),f=p,u=0}else f=c;let m=!0;if(t){let p=new CustomEvent("willPaste",{detail:{text:n}});this.fireEvent("willPaste",p),n=p.detail.text,m=!p.defaultPrevented}return m&&(f.insertData(u,n),e.setStart(f,u+n.length),e.collapse(!0)),this.setSelection(e),this}let o=n.split(`
`),s=this._config,r=s.blockTag,l=s.blockAttributes,a="</"+r+">",d="<"+r;for(let c in l)d+=" "+c+'="'+be(l[c])+'"';d+=">";for(let c=0,u=o.length;c<u;c+=1){let f=o[c];f=be(f).replace(/ (?=(?: |$))/g,"&nbsp;"),c&&(f=d+(f||"<BR>")+a),o[c]=f}return this.insertHTML(o.join(""),t)}getSelectedText(n){return me(n||this.getSelection())}getFontInfo(n){let t={color:void 0,backgroundColor:void 0,fontFamily:void 0,fontSize:void 0};n||(n=this.getSelection());let e=0,o=n.commonAncestorContainer;if(n.collapsed||o instanceof Text)for(o instanceof Text&&(o=o.parentNode);e<4&&o;){let s=o.style;if(s){let r=s.color;!t.color&&r&&(t.color=r,e+=1);let l=s.backgroundColor;!t.backgroundColor&&l&&(t.backgroundColor=l,e+=1);let a=s.fontFamily;!t.fontFamily&&a&&(t.fontFamily=a,e+=1);let d=s.fontSize;!t.fontSize&&d&&(t.fontSize=d,e+=1)}o=o.parentNode}return t}hasFormat(n,t,e){n=n.toUpperCase(),t||(t={}),e||(e=this.getSelection()),!e.collapsed&&e.startContainer instanceof Text&&e.startOffset===e.startContainer.length&&e.startContainer.nextSibling&&e.setStartBefore(e.startContainer.nextSibling),!e.collapsed&&e.endContainer instanceof Text&&e.endOffset===0&&e.endContainer.previousSibling&&e.setEndAfter(e.endContainer.previousSibling);let o=this._root,s=e.commonAncestorContainer;if(S(s,o,n,t))return!0;if(s instanceof Text)return!1;let r=new T(s,4,d=>G(e,d,!0)),l=!1,a;for(;a=r.nextNode();){if(!S(a,o,n,t))return!1;l=!0}return l}changeFormat(n,t,e,o){return e||(e=this.getSelection()),this.saveUndoState(e),t&&(e=this._removeFormat(t.tag.toUpperCase(),t.attributes||{},e,o)),n&&(e=this._addFormat(n.tag.toUpperCase(),n.attributes||{},e)),this.setSelection(e),this._updatePath(e,!0),this.focus()}_addFormat(n,t,e){let o=this._root;if(e.collapsed){let s=v(N(n,t));X(e,s);let r=s.firstChild||s,l=r instanceof Text?r.length:0;e.setStart(r,l),e.collapse(!0);let a=s;for(;g(a);)a=a.parentNode;ie(a,s)}else{let s=new T(e.commonAncestorContainer,5,c=>(c instanceof Text||c.nodeName==="BR"||c.nodeName==="IMG")&&G(e,c,!0)),{startContainer:r,startOffset:l,endContainer:a,endOffset:d}=e;if(s.currentNode=r,!(r instanceof Element)&&!(r instanceof Text)||!s.filter(r)){let c=s.nextNode();if(!c)return e;r=c,l=0}do{let c=s.currentNode;if(!S(c,o,n,t)){c===a&&c.length>d&&c.splitText(d),c===r&&l&&(c=c.splitText(l),a===r?(a=c,d-=l):a===r.parentNode&&(d+=1),r=c,l=0);let f=N(n,t);k(c,f),f.appendChild(c)}}while(s.nextNode());e=Y(r,l,a,d)}return e}_removeFormat(n,t,e,o){let{cantFocusEmptyTextNodes:s}=U();this._saveRangeToBookmark(e);let r;e.collapsed&&(s?r=document.createTextNode(y):r=document.createTextNode(""),X(e,r));let l=e.commonAncestorContainer;for(;g(l);)l=l.parentNode;let a=e.startContainer,d=e.startOffset,c=e.endContainer,u=e.endOffset,f=[],m=(h,R)=>{if(G(e,h,!1))return;let b,O;if(!G(e,h,!0)){!(h instanceof HTMLInputElement)&&(!(h instanceof Text)||h.data)&&f.push([R,h]);return}if(h instanceof Text)h===c&&u!==h.length&&f.push([R,h.splitText(u)]),h===a&&d&&(h.splitText(d),f.push([R,h]));else for(b=h.firstChild;b;b=O)O=b.nextSibling,m(b,R)},p=Array.from(l.getElementsByTagName(n)).filter(h=>G(e,h,!0)&&ce(h,n,t));if(o||p.forEach(h=>{m(h,h)}),f.forEach(([h,R])=>{h=h.cloneNode(!1),k(R,h),h.appendChild(R)}),p.forEach(h=>{k(h,C(h))}),s&&r){r=r.parentNode;let h=r;for(;h&&g(h);)h=h.parentNode;h&&ie(h,r)}return this._getRangeAndRemoveBookmark(e),r&&e.collapse(!1),ne(l,e),e}bold(){return this.changeFormat({tag:"B"})}removeBold(){return this.changeFormat(null,{tag:"B"})}italic(){return this.changeFormat({tag:"I"})}removeItalic(){return this.changeFormat(null,{tag:"I"})}underline(){return this.changeFormat({tag:"U"})}removeUnderline(){return this.changeFormat(null,{tag:"U"})}strikethrough(){return this.changeFormat({tag:"S"})}removeStrikethrough(){return this.changeFormat(null,{tag:"S"})}subscript(){return this.changeFormat({tag:"SUB"},{tag:"SUP"})}removeSubscript(){return this.changeFormat(null,{tag:"SUB"})}superscript(){return this.changeFormat({tag:"SUP"},{tag:"SUB"})}removeSuperscript(){return this.changeFormat(null,{tag:"SUP"})}makeLink(n,t){let e=this.getSelection();if(e.collapsed){let o=n.indexOf(":")+1;if(o)for(;n[o]==="/";)o+=1;X(e,document.createTextNode(n.slice(o)))}return t=Object.assign({href:n},this._config.tagAttributes.a,t),this.changeFormat({tag:"A",attributes:t},{tag:"A"},e)}removeLink(){return this.changeFormat(null,{tag:"A"},this.getSelection(),!0)}addDetectedLinks(n,t){let e=new T(n,4,l=>!S(l,t||this._root,"A")),o=this.linkRegExp,s=this._config.tagAttributes.a,r;for(;r=e.nextNode();){let l=r.parentNode,a=r.data,d;for(;d=o.exec(a);){let c=d.index,u=c+d[0].length;c&&l.insertBefore(document.createTextNode(a.slice(0,c)),r);let f=N("A",Object.assign({href:d[1]?/^(?:ht|f)tps?:/i.test(d[1])?d[1]:"http://"+d[1]:"mailto:"+d[0]},s));f.textContent=a.slice(c,u),l.insertBefore(f,r),r.data=a=a.slice(u)}}return this}setFontFace(n){let t=this._config.classNames.fontFamily;return this.changeFormat(n?{tag:"SPAN",attributes:{class:t,style:"font-family: "+n+", sans-serif;"}}:null,{tag:"SPAN",attributes:{class:t}})}setFontSize(n){let t=this._config.classNames.fontSize;return this.changeFormat(n?{tag:"SPAN",attributes:{class:t,style:"font-size: "+(typeof n=="number"?n+"px":n)}}:null,{tag:"SPAN",attributes:{class:t}})}setTextColor(n){let t=this._config.classNames.color;return this.changeFormat(n?{tag:"SPAN",attributes:{class:t,style:"color:"+n}}:null,{tag:"SPAN",attributes:{class:t}})}setHighlightColor(n){let t=this._config.classNames.highlight;return this.changeFormat(n?{tag:"SPAN",attributes:{class:t,style:"background-color:"+n}}:null,{tag:"SPAN",attributes:{class:t}})}_ensureBottomLine(){let n=this._root,t=n.lastElementChild;(!t||t.nodeName!==this._config.blockTag||!q(t))&&n.appendChild(this.createDefaultBlock())}createDefaultBlock(n){let t=this._config;return v(N(t.blockTag,t.blockAttributes,n))}splitBlock(n,t){t||(t=this.getSelection());let e=this._root,o,s,r,l;if(this._recordUndoState(t),this._removeZWS(),this._getRangeAndRemoveBookmark(t),t.collapsed||P(t,e),this._config.addLinks){x(t);let f=t.startContainer,m=t.startOffset;setTimeout(()=>{Ne(this,f,m)},0)}if(o=L(t,e),o&&(s=S(o,e,"PRE"))){x(t),r=t.startContainer;let f=t.startOffset;return r instanceof Text||(r=document.createTextNode(""),s.insertBefore(r,s.firstChild)),!n&&r instanceof Text&&(r.data.charAt(f-1)===`
`||V(t,e))&&(r.data.charAt(f)===`
`||Q(t,e))?(r.deleteData(f&&f-1,f?2:1),l=w(r,f&&f-1,e,e),r=l.previousSibling,r.textContent||_(r),r=this.createDefaultBlock(),l.parentNode.insertBefore(r,l),l.textContent||_(l),t.setStart(r,0)):(r.insertData(f,`
`),v(s),r.length===f+1?t.setStartAfter(r):t.setStart(r,f+1)),t.collapse(!0),this.setSelection(t),this._updatePath(t,!0),this._docWasChanged(),this}if(!o||n||/^T[HD]$/.test(o.nodeName))return xe(t,"A",e),X(t,N("BR")),t.collapse(!1),this.setSelection(t),this._updatePath(t,!0),this;if((s=S(o,e,"LI"))&&(o=s),le(o)){if(S(o,e,"UL")||S(o,e,"OL"))return this.decreaseListLevel(t),this;if(S(o,e,"BLOCKQUOTE"))return this.removeQuote(t),this}r=t.startContainer;let a=t.startOffset,d=this.tagAfterSplit[o.nodeName];l=w(r,a,o.parentNode,this._root);let c=this._config,u=null;for(d||(d=c.blockTag,u=c.blockAttributes),ce(l,d,u)||(o=N(d,u),l.dir&&(o.dir=l.dir),k(l,o),o.appendChild(C(l)),l=o),ie(o),he(o),v(o);l instanceof Element;){let f=l.firstChild,m;if(l.nodeName==="A"&&(!l.textContent||l.textContent===y)){f=document.createTextNode(""),k(l,f),l=f;break}for(;f&&f instanceof Text&&!f.data&&(m=f.nextSibling,!(!m||m.nodeName==="BR"));)_(f),f=m;if(!f||f.nodeName==="BR"||f instanceof Text)break;l=f}return t=Y(l,0),this.setSelection(t),this._updatePath(t,!0),this}forEachBlock(n,t,e){e||(e=this.getSelection()),t&&this.saveUndoState(e);let o=this._root,s=L(e,o),r=j(e,o);if(s&&r)do if(n(s)||s===r)break;while(s=z(s,o));return t&&(this.setSelection(e),this._updatePath(e,!0)),this}modifyBlocks(n,t){t||(t=this.getSelection()),this._recordUndoState(t,this._isInUndoState);let e=this._root;ve(t,e),K(t,e,e,e);let o=Le(t,e,e);if(!t.collapsed){let s=t.endContainer;if(s===e)t.collapse(!1);else{for(;s.parentNode!==e;)s=s.parentNode;t.setStartBefore(s),t.collapse(!0)}}return X(t,n.call(this,o)),t.endOffset<t.endContainer.childNodes.length&&H(t.endContainer.childNodes[t.endOffset],e),H(t.startContainer.childNodes[t.startOffset],e),this._getRangeAndRemoveBookmark(t),this.setSelection(t),this._updatePath(t,!0),this}setTextAlignment(n){let{align:t}=this._config.classNames,e=["left","right","center","justify"].includes(n);return this.forEachBlock(o=>{let s=o.className.split(/\s+/).filter(r=>!!r&&!(r!=null&&r.startsWith(t))).join(" ");e?(o.className=(s?s+" ":"")+t+"-"+n,o.style.textAlign=n):(o.className=s,o.style.textAlign="")},!0),this.focus()}setTextDirection(n){return this.forEachBlock(t=>{n?t.dir=n:t.removeAttribute("dir")},!0),this.focus()}_getListSelection(n,t){let e=n.commonAncestorContainer,o=n.startContainer,s=n.endContainer;for(;e&&e!==t&&!/^[OU]L$/.test(e.nodeName);)e=e.parentNode;if(!e||e===t)return null;for(o===e&&(o=o.childNodes[n.startOffset]),s===e&&(s=s.childNodes[n.endOffset]);o&&o.parentNode!==e;)o=o.parentNode;for(;s&&s.parentNode!==e;)s=s.parentNode;return[e,o,s]}increaseListLevel(n){n||(n=this.getSelection());let t=this._root,e=this._getListSelection(n,t);if(!e)return this.focus();let[o,s,r]=e;if(!s||s===o.firstChild)return this.focus();this._recordUndoState(n,this._isInUndoState);let l=o.nodeName,a=s.previousSibling,d,c;a.nodeName!==l&&(d=this._config.tagAttributes[l.toLowerCase()],a=N(l,d),o.insertBefore(a,s));do c=s===r?null:s.nextSibling,a.appendChild(s);while(s=c);return c=a.nextSibling,c&&H(c,t),this._getRangeAndRemoveBookmark(n),this.setSelection(n),this._updatePath(n,!0),this.focus()}decreaseListLevel(n){n||(n=this.getSelection());let t=this._root,e=this._getListSelection(n,t);if(!e)return this.focus();let[o,s,r]=e;s||(s=o.firstChild),r||(r=o.lastChild),this._recordUndoState(n,this._isInUndoState);let l,a=null;if(s){let d=o.parentNode;if(a=r.nextSibling?w(o,r.nextSibling,d,t):o.nextSibling,d!==t&&d.nodeName==="LI"){for(d=d.parentNode;a;)l=a.nextSibling,r.appendChild(a),a=l;a=o.parentNode.nextSibling}let c=!/^[OU]L$/.test(d.nodeName);do l=s===r?null:s.nextSibling,o.removeChild(s),c&&s.nodeName==="LI"&&(s=this.createDefaultBlock([C(s)])),d.insertBefore(s,a);while(s=l)}return o.firstChild||_(o),a&&H(a,t),this._getRangeAndRemoveBookmark(n),this.setSelection(n),this._updatePath(n,!0),this.focus()}_makeList(n,t){let e=re(n,this._root),o=this._config.tagAttributes,s=o[t.toLowerCase()],r=o.li,l;for(;l=e.nextNode();)if(l.parentNode instanceof HTMLLIElement&&(l=l.parentNode,e.currentNode=l.lastChild),l instanceof HTMLLIElement){l=l.parentNode;let a=l.nodeName;a!==t&&/^[OU]L$/.test(a)&&k(l,N(t,s,[C(l)]))}else{let a=N("LI",r);l.dir&&(a.dir=l.dir);let d=l.previousSibling;d&&d.nodeName===t?(d.appendChild(a),_(l)):k(l,N(t,s,[a])),a.appendChild(C(l)),e.currentNode=a}return n}makeUnorderedList(){return this.modifyBlocks(n=>this._makeList(n,"UL")),this.focus()}makeOrderedList(){return this.modifyBlocks(n=>this._makeList(n,"OL")),this.focus()}removeList(){return this.modifyBlocks(n=>{let t=n.querySelectorAll("UL, OL"),e=n.querySelectorAll("LI"),o=this._root;for(let s=0,r=t.length;s<r;s+=1){let l=t[s],a=C(l);A(a,o),k(l,a)}for(let s=0,r=e.length;s<r;s+=1){let l=e[s];q(l)?k(l,this.createDefaultBlock([C(l)])):(A(l,o),k(l,C(l)))}return n}),this.focus()}increaseQuoteLevel(n){return this.modifyBlocks(t=>N("BLOCKQUOTE",this._config.tagAttributes.blockquote,[t]),n),this.focus()}decreaseQuoteLevel(n){return this.modifyBlocks(t=>(Array.from(t.querySelectorAll("blockquote")).filter(e=>!S(e.parentNode,t,"BLOCKQUOTE")).forEach(e=>{k(e,C(e))}),t),n),this.focus()}removeQuote(n){return this.modifyBlocks(()=>this.createDefaultBlock([N("INPUT",{id:this.startSelectionId,type:"hidden"}),N("INPUT",{id:this.endSelectionId,type:"hidden"})]),n),this.focus()}code(){let n=this.getSelection();return n.collapsed||$(n.commonAncestorContainer)?(this.modifyBlocks(t=>{let e=this._root,o=document.createDocumentFragment(),s=re(t,e),r;for(;r=s.nextNode();){let a=r.querySelectorAll("BR"),d=[],c=a.length;for(let u=0;u<c;u+=1)d[u]=te(a[u],!1);for(;c--;){let u=a[c];d[c]?k(u,document.createTextNode(`
`)):_(u)}for(a=r.querySelectorAll("CODE"),c=a.length;c--;)k(a[c],C(a[c]));o.childNodes.length&&o.appendChild(document.createTextNode(`
`)),o.appendChild(C(r))}let l=new T(o,4);for(;r=l.nextNode();)r.data=r.data.replace(/ /g," ");return o.normalize(),v(N("PRE",this._config.tagAttributes.pre,[o]))},n),this.focus()):this.changeFormat({tag:"CODE",attributes:this._config.tagAttributes.code},null,n),this}removeCode(){let n=this.getSelection(),t=n.commonAncestorContainer;return S(t,this._root,"PRE")?(this.modifyBlocks(o=>{let s=this._root,r=o.querySelectorAll("PRE"),l=r.length;for(;l--;){let a=r[l],d=new T(a,4),c;for(;c=d.nextNode();){let u=c.data;u=u.replace(/ (?= )/g,"\xA0");let f=document.createDocumentFragment(),m;for(;(m=u.indexOf(`
`))>-1;)f.appendChild(document.createTextNode(u.slice(0,m))),f.appendChild(N("BR")),u=u.slice(m+1);c.parentNode.insertBefore(f,c),c.data=u}A(a,s),k(a,C(a))}return o},n),this.focus()):this.changeFormat(null,{tag:"CODE"},n),this}toggleCode(){return this.hasFormat("PRE")||this.hasFormat("CODE")?this.removeCode():this.code(),this}_removeFormatting(n,t){for(let e=n.firstChild,o;e;e=o){if(o=e.nextSibling,g(e)){if(e instanceof Text||e.nodeName==="BR"||e.nodeName==="IMG"){t.appendChild(e);continue}}else if(q(e)){t.appendChild(this.createDefaultBlock([this._removeFormatting(e,document.createDocumentFragment())]));continue}this._removeFormatting(e,t)}return t}removeAllFormatting(n){if(n||(n=this.getSelection()),n.collapsed)return this.focus();let t=this._root,e=n.commonAncestorContainer;for(;e&&!q(e);)e=e.parentNode;if(e||(ve(n,t),e=t),e instanceof Text)return this.focus();this.saveUndoState(n),K(n,e,e,t);let o=n.startContainer,s=n.startOffset,r=n.endContainer,l=n.endOffset,a=document.createDocumentFragment(),d=document.createDocumentFragment(),c=w(r,l,e,t),u=w(o,s,e,t),f;for(;u!==c;)f=u.nextSibling,a.appendChild(u),u=f;if(this._removeFormatting(a,d),d.normalize(),u=d.firstChild,f=d.lastChild,u){e.insertBefore(d,c);let m=Array.from(e.childNodes);s=m.indexOf(u),l=f?m.indexOf(f)+1:0}else c&&(s=Array.from(e.childNodes).indexOf(c),l=s);return n.setStart(e,s),n.setEnd(e,l),ne(e,n),x(n),this.setSelection(n),this._updatePath(n,!0),this.focus()}};window.Squire=ge;})();
//# sourceMappingURL=squire.js.map
